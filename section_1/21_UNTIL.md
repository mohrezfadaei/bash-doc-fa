# راهنمای جامع و کامل حلقه `until` در Bash

حلقه `until` در Bash مانند حلقه `while` عمل می‌کند، با این تفاوت که تا زمانی که شرط نادرست باشد، حلقه اجرا می‌شود. یعنی حلقه `until` دستورات درون خود را تا زمانی که شرط به مقدار `true` نرسد، اجرا می‌کند و زمانی که شرط برقرار شد، اجرای حلقه متوقف می‌شود.

در این مستند به بررسی ساختار کلی حلقه `until`، نحوه استفاده از آن، گزینه‌های مختلف و نکات و ترفندهای پیشرفته خواهیم پرداخت.

## 1. ساختار کلی حلقه `until`

حلقه `until` دستورات را تکرار می‌کند تا زمانی که شرطی که مشخص شده است به مقدار `true` تبدیل شود. زمانی که شرط برقرار شود، اجرای حلقه متوقف خواهد شد.

### ساختار کلی:

```bash
until [ شرط ]; do
  دستورات
done
```

### مثال ساده:

```bash
#!/bin/bash
count=1
until [ $count -gt 5 ]; do
  echo "عدد: $count"
  ((count++))
done
```

در این مثال، حلقه `until` تا زمانی که مقدار `count` بیشتر از 5 نباشد، اجرا می‌شود. هنگامی که `count` به عدد 6 برسد، شرط برقرار می‌شود و اجرای حلقه متوقف می‌شود.

## 2. روش‌های مختلف استفاده از حلقه `until`

### 2.1. حلقه `until` با شرط عددی

مانند حلقه `while`، می‌توان از حلقه `until` برای کنترل مقادیر عددی و اجرای یک سری دستورات تا زمانی که مقدار مشخصی از یک عدد به‌دست نیاید، استفاده کرد.

#### مثال:

```bash
#!/bin/bash
number=10
until [ $number -le 0 ]; do
  echo "شمارش معکوس: $number"
  ((number--))
done
```

در این مثال، حلقه `until` تا زمانی که `number` بزرگ‌تر از 0 است، اجرا می‌شود. وقتی `number` به صفر یا کمتر برسد، حلقه متوقف می‌شود.

### 2.2. حلقه `until` برای خواندن فایل‌ها

یکی دیگر از کاربردهای حلقه `until` خواندن داده‌ها از یک فایل است. حلقه تا زمانی که پایان فایل نرسیده باشد، ادامه پیدا می‌کند.

#### مثال:

```bash
#!/bin/bash
until read -r line; do
  echo "خط: $line"
done < /path/to/file.txt
```

در این مثال، حلقه `until` تا زمانی که دستور `read` به خطای پایان فایل نرسیده باشد، اجرا خواهد شد.

### 2.3. استفاده از `until` با دستورات Bash

حلقه `until` می‌تواند برای اجرای دستورات و عملیات‌هایی استفاده شود که باید تا رسیدن به یک شرایط خاص، به‌طور مکرر اجرا شوند.

#### مثال:

```bash
#!/bin/bash
until ping -c 1 google.com &> /dev/null; do
  echo "سایت هنوز در دسترس نیست."
  sleep 5
done
echo "سایت اکنون در دسترس است."
```

در این مثال، حلقه `until` تا زمانی که سایت `google.com` پاسخ ندهد، اجرا می‌شود و پیغام "سایت هنوز در دسترس نیست." چاپ می‌شود. وقتی سایت در دسترس قرار گرفت، حلقه متوقف می‌شود.

### 2.4. حلقه بی‌نهایت با `until`

با استفاده از حلقه `until` می‌توانید یک حلقه بی‌نهایت ایجاد کنید که تا زمانی که شرط خاصی برقرار نشود، به طور مداوم اجرا شود.

#### مثال:

```bash
#!/bin/bash
until false; do
  echo "این حلقه بی‌نهایت است."
done
```

این حلقه تا زمانی که شرط `false` باشد (که همیشه نادرست است) اجرا خواهد شد و این به معنای یک حلقه بی‌نهایت است. برای توقف حلقه می‌توانید از سیگنال‌هایی مانند `Ctrl+C` استفاده کنید.

## 3. استفاده از `break` و `continue` در حلقه `until`

### 3.1. `break`

دستور `break` برای خاتمه دادن فوری به اجرای حلقه استفاده می‌شود. وقتی `break` اجرا شود، حلقه بلافاصله متوقف شده و اجرای کد از بیرون حلقه ادامه پیدا می‌کند.

#### مثال:

```bash
#!/bin/bash
count=1
until [ $count -gt 10 ]; do
  if [ $count -eq 5 ]; then
    break
  fi
  echo "عدد: $count"
  ((count++))
done
```

در این مثال، حلقه تا زمانی که `count` برابر با 5 نباشد، ادامه پیدا می‌کند. وقتی `count` به 5 برسد، دستور `break` اجرا می‌شود و حلقه متوقف می‌شود.

### 3.2. `continue`

دستور `continue` باعث می‌شود که اجرای دستورات باقی‌مانده در دور فعلی حلقه نادیده گرفته شود و حلقه از دور بعدی ادامه پیدا کند.

#### مثال:

```bash
#!/bin/bash
count=1
until [ $count -gt 10 ]; do
  ((count++))
  if [ $count -eq 5 ]; then
    continue
  fi
  echo "عدد: $count"
done
```

در این مثال، وقتی مقدار `count` برابر با 5 شود، دستور `continue` اجرا شده و از چاپ آن جلوگیری می‌شود. سپس حلقه با مقادیر بعدی ادامه پیدا می‌کند.

## 4. حلقه‌های تو در تو با `until`

می‌توانید حلقه‌های `until` را به صورت تو در تو قرار دهید تا عملیات‌های پیچیده‌تری انجام دهید.

#### مثال:

```bash
#!/bin/bash
outer=1
until [ $outer -gt 3 ]; do
  inner=1
  until [ $inner -gt 3 ]; do
    echo "Outer loop: $outer, Inner loop: $inner"
    ((inner++))
  done
  ((outer++))
done
```

در این مثال، یک حلقه `until` تو در تو داریم که در هر دور از حلقه خارجی، حلقه داخلی نیز چندین بار اجرا می‌شود.

## 5. نکات و ترفندها

### 5.1. حلقه بی‌نهایت با `until true`

می‌توانید از دستور `true` به عنوان یک شرط نادرست برای ایجاد یک حلقه بی‌نهایت استفاده کنید.

#### مثال:

```bash
#!/bin/bash
until true; do
  echo "این حلقه بی‌نهایت است."
done
```

### 5.2. استفاده از `until` برای زمان‌بندی دستورات

می‌توانید از حلقه `until` برای انجام دستورات با تأخیر‌های زمانی خاص استفاده کنید. به‌عنوان مثال، اگر نیاز دارید که یک دستور را هر چند ثانیه یک بار تا زمان برقراری یک شرط تکرار کنید، می‌توانید از ترکیب `sleep` و `until` استفاده کنید.

#### مثال:

```bash
#!/bin/bash
until curl -s https://example.com &> /dev/null; do
  echo "در انتظار دسترسی به سرور..."
  sleep 10
done
echo "سرور اکنون در دسترس است."
```

### 5.3. خواندن فایل با `IFS` در حلقه `until`

می‌توانید با تغییر متغیر `IFS` (Internal Field Separator) از حلقه `until` برای پردازش فایل‌های داده با فرمت‌های مختلف مانند CSV استفاده کنید.

#### مثال:

```bash
#!/bin/bash
IFS=","
until read name age; do
  echo "نام: $name، سن: $age"
done < data.csv
```

در این مثال، فایل CSV با جداکننده کاما خوانده می‌شود و هر سطر از داده‌ها به عنوان یک نام و سن پردازش می‌شود.

## 6. جدول مقایسه دستورات و قابلیت‌های `until`

| قابلیت           | توضیحات                             | مثال                                          |
| ---------------- | ----------------------------------- | --------------------------------------------- |
| `break`          | خاتمه فوری حلقه                     | متوقف کردن حلقه وقتی که یک شرط خاص برقرار شود |
| `continue`       | ادامه اجرای حلقه از دور بعدی        | رد کردن دستورات باقی‌مانده در یک دور خاص      |
| حلقه بی‌نهایت    | تکرار حلقه به طور مداوم بدون توقف   | `until true; do ... done`                     |
| خواندن فایل      | پردازش خط به خط فایل‌ها تا پایان آن | `until read line; do ... done < file`         |
| دستورات با تأخیر | تکرار دستورات با تأخیر‌های زمانی    | `until [شرط]; do ... sleep N; done`           |

## جمع‌بندی

حلقه `until` در Bash یکی از ابزارهای مفید برای انجام عملیات تکراری تا زمان برقراری یک شرط خاص است. این حلقه تا زمانی که شرط نادرست است اجرا می‌شود و زمانی که شرط برقرار شود، اجرای حلقه خاتمه می‌یابد. با استفاده از قابلیت‌هایی مانند `break`، `continue`، و ترکیب این حلقه با دستورات Bash می‌توانید عملیات‌های پیچیده‌تر و کار

آمدتری را در اسکریپت‌های خود پیاده‌سازی کنید.

### جدول خلاصه حلقه `until`

| ویژگی                    | توضیحات                                          | مثال                                 |
| ------------------------ | ------------------------------------------------ | ------------------------------------ |
| ساختار کلی               | اجرای دستورات تا زمانی که شرط نادرست باشد        | `until [شرط]; do ... done`           |
| حلقه بی‌نهایت            | تکرار بی‌نهایت حلقه تا زمانی که شرط نادرست بماند | `until true; do ... done`            |
| کنترل حلقه با `break`    | توقف فوری اجرای حلقه                             | `if [ $i -eq 5 ]; then break; fi`    |
| کنترل حلقه با `continue` | ادامه اجرای حلقه از دور بعدی                     | `if [ $i -eq 3 ]; then continue; fi` |
