# تعریف متغیرها در Bash

در Bash، متغیرها یکی از عناصر کلیدی در اسکریپت‌نویسی و مدیریت سیستم هستند. متغیرها به شما امکان می‌دهند مقادیر را ذخیره کنید و در نقاط مختلف اسکریپت از آنها استفاده کنید. این مقاله به شما کمک می‌کند تا با تعریف متغیرها، انواع آنها و روش‌های دسترسی به آنها به صورت حرفه‌ای و کامل آشنا شوید.

## قانون تعریف متغیر

در Bash، تعریف یک متغیر به این صورت انجام می‌شود:

```bash
VARIABLE_NAME=value
```

- **قانون اصلی**: متغیرها باید بدون فاصله بین نام و مقدار تعریف شوند.
- از علامت `=` برای تخصیص مقدار به متغیر استفاده می‌شود.
- متغیرها به صورت پیش‌فرض نوع داده ندارند و همه مقادیر به عنوان رشته ذخیره می‌شوند.

## اهمیت Whitespace در تعریف

استفاده از فاصله (whitespace) در تعریف متغیرها بسیار مهم است. Bash نسبت به فاصله‌ها حساس است:

- **صحیح**:

  ```bash
  VAR1="Hello"
  ```

- **غلط**:
  ```bash
  VAR1 = "Hello"  # خطا: فضای خالی قبل و بعد از علامت "=" وجود دارد.
  ```

اضافه کردن فضای خالی باعث می‌شود Bash متغیر را به اشتباه تفسیر کند.

## انواع درست و غلط نامیدن متغیرها

### نام‌های صحیح:

- باید با حروف یا زیرخط (`_`) شروع شوند.
- می‌توانند شامل حروف، اعداد و زیرخط باشند.

مثال:

```bash
MY_VAR=123
_varName="Bash"
```

### نام‌های غلط:

- شروع با عدد مجاز نیست.
- استفاده از کاراکترهای خاص مانند `@`, `#`, `-`, `!` مجاز نیست.

مثال غلط:

```bash
1stVariable="Wrong"
my-var="Invalid"
```

## انواع روش‌های دسترسی به یک متغیر

برای دسترسی به مقدار یک متغیر، باید از علامت `$` قبل از نام متغیر استفاده کنید:

```bash
echo $VARIABLE_NAME
```

### دسترسی در رشته:

می‌توانید متغیر را درون یک رشته نیز استفاده کنید:

```bash
echo "My variable is $VARIABLE_NAME"
```

در صورتی که متغیر را به درستی تعریف نکرده باشید، Bash مقدار خالی نمایش می‌دهد.

## Local Variables

متغیرهای محلی تنها در داخل یک تابع یا اسکریپت دسترسی‌پذیر هستند. این متغیرها به صورت خودکار پس از اتمام اجرای تابع یا اسکریپت از بین می‌روند.

مثال:

```bash
function my_function {
  local MY_VAR="local"
  echo $MY_VAR
}
my_function  # خروجی: local
```

## Environment Variables

متغیرهای محیطی (Environment Variables) در سراسر سیستم و در همه فرآیندهای جاری دسترسی‌پذیر هستند. برای تعریف یک متغیر محیطی از دستور `export` استفاده می‌شود:

```bash
export MY_ENV_VAR="This is an environment variable"
```

این متغیر در تمام فرآیندها و اسکریپت‌های بعدی قابل دسترسی است.

## تخصیص مقدار به متغیرها

مقداردهی به متغیرها در Bash به راحتی و بدون نیاز به نوع داده انجام می‌شود. هر متغیر به صورت رشته ذخیره می‌شود و می‌تواند هر نوع داده‌ای (عدد، متن، و غیره) را نگه دارد.

مثال:

```bash
NUMBER=42
TEXT="Hello World"
```

## read-only

با استفاده از دستور `readonly` می‌توان متغیرهایی ایجاد کرد که نمی‌توان مقدار آنها را تغییر داد:

```bash
readonly MY_CONSTANT="This is constant"
```

پس از تعریف متغیر به صورت `readonly`، هر تلاشی برای تغییر مقدار آن با خطا مواجه خواهد شد.

## نکات کار با readonly

- بعد از اینکه یک متغیر به صورت `readonly` تعریف شد، نمی‌توانید آن را مجدداً مقداردهی کنید.
- می‌توانید لیستی از متغیرهای `readonly` را با دستور زیر مشاهده کنید:
  ```bash
  readonly
  ```

## حذف متغیرها

برای حذف یک متغیر از دستور `unset` استفاده می‌شود:

```bash
unset VARIABLE_NAME
```

این دستور متغیر را از حافظه حذف می‌کند و دیگر قابل دسترسی نخواهد بود.

## حذف متغیرهای read-only

متغیرهای `readonly` را نمی‌توان به سادگی با دستور `unset` حذف کرد. تلاش برای حذف چنین متغیری منجر به خطا می‌شود:

```bash
unset MY_CONSTANT  # خطا: نمی‌توان متغیر readonly را حذف کرد.
```

## ترفند حذف متغیرهای read-only

به طور کلی، در سیستم‌های لینوکسی حذف متغیرهای `readonly` با استفاده از ابزارهای استاندارد مانند `unset` امکان‌پذیر نیست. اما یک ترفند می‌تواند این کار را انجام دهد؛ با استفاده از دستورات سطح پایین‌تر یا دستکاری مستقیم فضای حافظه:

### استفاده از Bash Debugger:

یکی از ترفندهای پیشرفته این است که از Bash Debugger برای حذف یا بازنشانی متغیرهای `readonly` استفاده کنید. این تکنیک نیازمند تغییر فضای حافظه فرآیند یا اجرای شل به صورت غیراستاندارد است که برای اکثر کاربران توصیه نمی‌شود.

### استفاده از Subshell:

می‌توانید از یک `subshell` استفاده کنید تا در یک محیط جدید، متغیر `readonly` شما از بین برود و تاثیرات آن محدود به محیط جدید باشد:

```bash
(
  unset MY_CONSTANT
  # این متغیر تنها در داخل این ساب‌شل unset می‌شود
)
```

این ترفند باعث می‌شود در محیط ساب‌شل متغیر `readonly` حذف شود، اما همچنان در محیط اصلی شما قابل دسترسی باقی بماند.
