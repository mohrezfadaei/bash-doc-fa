# راهنمای جامع و کامل حلقه `while` در Bash

حلقه `while` در Bash یکی از پرکاربردترین حلقه‌ها برای اجرای مکرر دستورات تا زمانی که یک شرط برقرار باشد است. این حلقه انعطاف‌پذیری بالایی برای انجام عملیات تکراری و کنترل جریان اجرای برنامه فراهم می‌کند. در این مستند به بررسی کامل ساختار حلقه `while`، گزینه‌های مختلف آن، و نکات و ترفندهای پیشرفته خواهیم پرداخت.

## 1. ساختار کلی حلقه `while`

در Bash، حلقه `while` تا زمانی که شرط برقرار باشد، دستورات درون حلقه را به صورت مکرر اجرا می‌کند.

### ساختار کلی:

```bash
while [ شرط ]; do
  دستورات
done
```

### مثال ساده:

```bash
#!/bin/bash
count=1
while [ $count -le 5 ]; do
  echo "عدد: $count"
  ((count++))
done
```

در این مثال، حلقه تا زمانی که مقدار `count` کمتر یا برابر با 5 باشد اجرا می‌شود. در هر دور از حلقه، مقدار `count` یک واحد افزایش می‌یابد و سپس چاپ می‌شود.

## 2. روش‌های استفاده از حلقه `while`

### 2.1. حلقه `while` با شرط عددی

می‌توانید از حلقه `while` برای انجام عملیات بر اساس شرایط عددی استفاده کنید. این نوع حلقه اغلب برای شمارش و کنترل‌های عددی به کار می‌رود.

#### مثال:

```bash
#!/bin/bash
number=10
while [ $number -gt 0 ]; do
  echo "شمارش معکوس: $number"
  ((number--))
done
```

### 2.2. استفاده از `while` با ورودی‌های فایل

یکی از کاربردهای مهم حلقه `while` خواندن داده‌ها از یک فایل یا ورودی‌های استاندارد است.

#### مثال:

```bash
#!/bin/bash
while read line; do
  echo "خط: $line"
done < /path/to/file.txt
```

در این مثال، هر خط از فایل `file.txt` خوانده شده و سپس درون حلقه چاپ می‌شود.

### 2.3. استفاده از `while` با دستورات

می‌توانید از خروجی یک دستور به عنوان شرط درون حلقه `while` استفاده کنید. به عنوان مثال، می‌توانید از دستور `ping` یا `curl` برای بررسی وضعیت شبکه یا سرویس‌های آنلاین استفاده کنید.

#### مثال:

```bash
#!/bin/bash
while ping -c 1 google.com &> /dev/null; do
  echo "سایت در دسترس است"
  sleep 5
done
echo "سایت از دسترس خارج شد"
```

### 2.4. حلقه بی‌نهایت با `while`

با استفاده از ساختار `while` می‌توانید یک حلقه بی‌نهایت ایجاد کنید. چنین حلقه‌ای تا زمانی که به‌طور دستی متوقف نشود (یا از `break` استفاده نشود) ادامه خواهد یافت.

#### مثال:

```bash
#!/bin/bash
while true; do
  echo "این حلقه بی‌نهایت است."
  sleep 1
done
```

برای توقف این حلقه می‌توانید از سیگنال‌های کنترلی مانند `Ctrl+C` استفاده کنید یا با استفاده از `break` آن را خاتمه دهید.

## 3. استفاده از `break` و `continue` در حلقه `while`

### 3.1. `break`

دستور `break` باعث خاتمه فوری حلقه می‌شود و اجرای کد به خارج از حلقه منتقل می‌شود. این دستور به‌ویژه زمانی که نیاز به خروج زودهنگام از حلقه دارید مفید است.

#### مثال:

```bash
#!/bin/bash
count=1
while [ $count -le 10 ]; do
  if [ $count -eq 5 ]; then
    break
  fi
  echo "عدد: $count"
  ((count++))
done
```

در این مثال، وقتی مقدار `count` برابر با 5 شود، دستور `break` اجرا شده و حلقه متوقف می‌شود.

### 3.2. `continue`

دستور `continue` باعث می‌شود که باقی دستورات در دور فعلی حلقه نادیده گرفته شوند و حلقه از دور بعدی ادامه پیدا کند.

#### مثال:

```bash
#!/bin/bash
count=1
while [ $count -le 10 ]; do
  ((count++))
  if [ $count -eq 5 ]; then
    continue
  fi
  echo "عدد: $count"
done
```

در این مثال، وقتی مقدار `count` برابر با 5 شود، دستور `continue` اجرا می‌شود و چاپ عدد 5 نادیده گرفته می‌شود. سپس حلقه با اعداد 6 به بعد ادامه پیدا می‌کند.

## 4. حلقه‌های تو در تو (Nested Loops)

در Bash می‌توانید حلقه‌های `while` را به صورت تو در تو قرار دهید تا عملیات‌های پیچیده‌تری را انجام دهید. در هر حلقه داخلی، می‌توانید از همان دستوراتی که در حلقه خارجی استفاده کرده‌اید بهره ببرید.

#### مثال:

```bash
#!/bin/bash
outer=1
while [ $outer -le 3 ]; do
  inner=1
  while [ $inner -le 3 ]; do
    echo "Outer loop: $outer, Inner loop: $inner"
    ((inner++))
  done
  ((outer++))
done
```

در این مثال، یک حلقه `while` تو در تو داریم که در هر دور از حلقه خارجی، حلقه داخلی نیز چند بار اجرا می‌شود.

## 5. گزینه‌های پیشرفته و نکات مهم

### 5.1. استفاده از IFS برای خواندن ورودی‌ها

می‌توانید از `IFS` (Internal Field Separator) برای تنظیم جداکننده ورودی‌ها در هنگام خواندن داده‌ها با `while` استفاده کنید. به‌طور پیش‌فرض `IFS` بر روی فضا و خط جدید تنظیم شده است، اما می‌توانید آن را برای پردازش داده‌های پیچیده‌تر مانند فایل‌های CSV تغییر دهید.

#### مثال:

```bash
#!/bin/bash
IFS=","
while read name age; do
  echo "نام: $name، سن: $age"
done < data.csv
```

### 5.2. حلقه بی‌نهایت با `while :`

علامت `:` در Bash به معنای یک دستور بی‌عمل است و همیشه `True` است. بنابراین با استفاده از `while :` می‌توانید یک حلقه بی‌نهایت ایجاد کنید که هیچ شرط خاصی ندارد.

#### مثال:

```bash
#!/bin/bash
while :; do
  echo "حلقه بی‌نهایت"
done
```

### 5.3. کنترل مدت زمان اجرای حلقه با `sleep`

در بسیاری از موارد، ممکن است نیاز داشته باشید که بین اجرای هر دور از حلقه مکث کنید. با استفاده از دستور `sleep` می‌توانید مدت زمان اجرای حلقه را کنترل کنید.

#### مثال:

```bash
#!/bin/bash
count=1
while [ $count -le 5 ]; do
  echo "عدد: $count"
  sleep 2  # دو ثانیه مکث
  ((count++))
done
```

### 5.4. اجرای چندین دستور در شرط `while`

در صورتی که نیاز به بررسی چندین شرط همزمان در یک حلقه `while` دارید، می‌توانید از عملگرهای منطقی مانند `&&` و `||` استفاده کنید.

#### مثال:

```bash
#!/bin/bash
count=1
while [ $count -le 5 ] && [ $count -ne 3 ]; do
  echo "عدد: $count"
  ((count++))
done
```

در این مثال، حلقه تا زمانی که `count` کمتر یا برابر با 5 باشد و مقدار آن برابر با 3 نباشد، اجرا می‌شود.

## 6. جدول مقایسه دستوراتی که در حلقه `while` استفاده می‌شوند

| دستور      | توضیحات                                                | مثال                                   |
| ---------- | ------------------------------------------------------ | -------------------------------------- |
| `break`    | توقف اجرای حلقه                                        | خاتمه فوری حلقه در صورت وقوع شرط خاص   |
| `continue` | رد کردن دستورات باقی‌مانده و ادامه اجرای دور بعدی حلقه | نادیده گرفتن یک شرط و ادامه اجرای حلقه |
| `sleep`    | مکث بین هر دور از حلقه                                 | `sleep 2` برای مکث 2 ثانیه‌ای          |
| `read`     | خواندن ورودی از کاربر یا فایل                          | `read line`                            |

## جمع‌بندی

حلقه `while` یکی از ابزارهای قدرتمند و منعطف در Bash برای انجام عملیات تکراری است. با استفاده از این حلقه می‌توانید شرط‌های مختلف را ارزیابی کرده و تا زمانی که آن شرط برقرار است، دستورات مورد نظر خود را اجرا کنید. همچنین، با استفاده از دستورات `break`، `continue` و تکنیک‌هایی مانند کنترل مدت زمان اجرای حلقه با `sleep`، می‌توانید کنترل کاملی بر جریان اجرای برنامه خود داشته باشید.
