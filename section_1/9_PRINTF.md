# راهنمای جامع و حرفه‌ای دستور `printf` در Bash

دستور `printf` در Bash یک ابزار قدرتمند برای فرمت‌دهی و چاپ متن‌ها، متغیرها و نتایج دستورات است. برخلاف `echo` که برای موارد ساده‌تر مناسب است، `printf` به شما این امکان را می‌دهد که کنترل بیشتری روی فرمت و چیدمان خروجی داشته باشید. این راهنمای جامع به شما نحوه استفاده از `printf`، گزینه‌های فرمت‌دهی، و نکات پیشرفته را نشان می‌دهد.

## 1. ساختار کلی `printf`

ساختار کلی دستور `printf` در Bash به شکل زیر است:

```bash
printf FORMAT [ARGUMENT]...
```

- **FORMAT**: رشته قالب (format string) که تعیین می‌کند چگونه خروجی چاپ شود.
- **ARGUMENT**: مقادیر یا متغیرهایی که بر اساس قالب فرمت‌دهی شده و چاپ می‌شوند.

### مثال ساده:

```bash
printf "Hello, %s!\n" "World"
```

خروجی:

```
Hello, World!
```

در این مثال، `%s` نشانگر یک رشته است که با مقدار `"World"` جایگزین می‌شود. `\n` برای افزودن خط جدید استفاده می‌شود.

## 2. Placeholders (جایگزین‌ها) در `printf`

`printf` از placeholderها یا جایگزین‌هایی برای فرمت‌دهی استفاده می‌کند. این placeholderها مشخص می‌کنند که چه نوع داده‌ای در خروجی چاپ شود و چگونه نمایش داده شود. برخی از placeholderهای مهم عبارتند از:

- **%s**: رشته (String)
- **%d**: عدد صحیح (Integer)
- **%f**: عدد اعشاری (Float)
- **%x**: عدد در مبنای شانزده (Hexadecimal)
- **%%**: علامت درصد `%`

### مثال:

```bash
NAME="Ali"
AGE=30
printf "Name: %s, Age: %d\n" "$NAME" "$AGE"
```

خروجی:

```
Name: Ali, Age: 30
```

در این مثال، `%s` برای چاپ رشته و `%d` برای چاپ عدد صحیح استفاده شده است.

## 3. فرمت‌دهی اعداد اعشاری (Floating-Point)

برای چاپ اعداد اعشاری با کنترل تعداد ارقام اعشار، می‌توانید از `%f` استفاده کنید. همچنین می‌توانید تعداد ارقام اعشار را مشخص کنید.

### مثال:

```bash
NUMBER=3.141592
printf "Pi: %.2f\n" "$NUMBER"
```

خروجی:

```
Pi: 3.14
```

در اینجا، `.2` تعیین می‌کند که دو رقم بعد از اعشار نمایش داده شود.

## 4. کنترل عرض فیلدها (Field Width)

با استفاده از `printf` می‌توانید عرض فیلدها را کنترل کنید. این ویژگی برای ایجاد جداول و چیدمان منظم داده‌ها بسیار مفید است. می‌توانید یک عدد را قبل از placeholder قرار دهید تا مشخص کنید که فیلد چه عرضی داشته باشد.

### مثال:

```bash
printf "%10s %10s\n" "Name" "Age"
printf "%10s %10d\n" "Alice" 25
printf "%10s %10d\n" "Bob" 30
```

خروجی:

```
      Name        Age
     Alice         25
       Bob         30
```

در این مثال، `%10s` و `%10d` عرض فیلد را برای رشته‌ها و اعداد به 10 کاراکتر تنظیم می‌کنند.

### نکته: تراز کردن به سمت چپ

برای تراز کردن به سمت چپ، می‌توانید از علامت منفی استفاده کنید:

```bash
printf "%-10s %-10s\n" "Name" "Age"
```

خروجی:

```
Name       Age
Alice      25
Bob        30
```

## 5. استفاده از `printf` برای اعداد در مبناهای مختلف

`printf` این امکان را فراهم می‌کند که اعداد را در مبناهای مختلف چاپ کنید. برای مثال، می‌توانید اعداد را در مبنای شانزده (Hexadecimal) یا مبنای هشت (Octal) چاپ کنید.

### مثال: چاپ عدد در مبنای شانزده

```bash
NUMBER=255
printf "Hexadecimal: %x\n" "$NUMBER"
```

خروجی:

```
Hexadecimal: ff
```

### مثال: چاپ عدد در مبنای هشت

```bash
NUMBER=64
printf "Octal: %o\n" "$NUMBER"
```

خروجی:

```
Octal: 100
```

## 6. چاپ چندین مقدار با `printf`

یکی از ویژگی‌های قدرتمند `printf` این است که می‌توانید چندین مقدار را به صورت همزمان چاپ کنید. `printf` با استفاده از placeholderها و مقادیر متوالی، به ازای هر placeholder، مقدار مربوطه را جایگزین می‌کند.

### مثال:

```bash
printf "Name: %s, Age: %d, Score: %.1f\n" "John" 25 95.7
```

خروجی:

```
Name: John, Age: 25, Score: 95.7
```

### تکرار قالب برای مقادیر بیشتر:

اگر تعداد مقادیر بیشتر از placeholderها باشد، `printf` به صورت چرخشی از قالب برای مقادیر اضافی استفاده می‌کند:

```bash
printf "%s %d\n" "Alice" 25 "Bob" 30 "Charlie" 35
```

خروجی:

```
Alice 25
Bob 30
Charlie 35
```

## 7. استفاده از `printf` برای چاپ در فایل

با استفاده از `printf` می‌توانید خروجی را به یک فایل هدایت کنید. این کار با استفاده از اپراتور `>` یا `>>` برای نوشتن یا اضافه کردن به فایل انجام می‌شود.

### مثال:

```bash
printf "Hello, World!\n" > output.txt
```

این دستور متن `"Hello, World!"` را در فایل `output.txt` ذخیره می‌کند.

برای اضافه کردن به فایل (بدون بازنویسی محتوا):

```bash
printf "Additional text\n" >> output.txt
```

## 8. Escape Sequences (کاراکترهای فراری)

با استفاده از `printf` می‌توانید از escape sequences برای چاپ کاراکترهای خاص مانند newline، tab، و غیره استفاده کنید. برخی از پرکاربردترین escape sequences عبارتند از:

- **\n**: خط جدید
- **\t**: tab
- **\\**: بک‌اسلش
- **\r**: بازگشت به ابتدای خط

### مثال:

```bash
printf "Line 1\nLine 2\n"
```

خروجی:

```
Line 1
Line 2
```

### مثال با tab:

```bash
printf "Column1\tColumn2\tColumn3\n"
```

خروجی:

```
Column1  Column2  Column3
```

## 9. مدیریت خطاها با `printf`

شما می‌توانید خروجی `printf` را به خروجی استاندارد خطا (stderr) هدایت کنید. برای این کار، از `>&2` استفاده کنید:

### مثال:

```bash
printf "Error: Something went wrong!\n" >&2
```

این دستور خطای `"Error: Something went wrong!"` را در خروجی خطا چاپ می‌کند.

## 10. چاپ یک علامت درصد (%)

برای چاپ یک علامت درصد در خروجی، باید از `%%` استفاده کنید. یک `%` به تنهایی به عنوان placeholder شناخته می‌شود و نیاز به escape دارد.

### مثال:

```bash
printf "Success rate: %d%%\n" 90
```

خروجی:

```
Success rate: 90%
```

## 11. ترفندهای پیشرفته با `printf`

### 1. محاسبات ریاضی

شما می‌توانید با استفاده از `$(( ))` عملیات ریاضی را انجام دهید و نتیجه را با `printf` چاپ کنید.

### مثال:

```bash
NUMBER=$((5 + 3))
printf "Sum: %d\n" "$NUMBER"
```

خروجی:

```
Sum: 8
```

### 2. چاپ محتوای فایل با `printf`

با استفاده از `cat` می‌توانید محتوای یک فایل را درون `printf` جایگذاری کرده و به شکلی خاص چاپ کنید.

### مثال:

```bash
printf "%s\n" "$(cat file.txt)"
```

این دستور محتوای فایل `file.txt` را چاپ می‌کند.

### 3. تولید خروجی‌های مرتب با `printf`

`printf` بسیار مفید است برای تولید جداول مرتب یا فرمت‌های مرتب دیگر. مثلاً برای تولید جدولی از داده‌ها:

```bash
printf "%-10s %-10s %-10s\n" "Name" "Age" "Score"
printf "%-10s %-10d %-10.1f\n" "Alice" 25 89.5
printf "%-10s %-10d %-10.1f\n" "Bob" 30 72.3
```

خروجی:

```
Name       Age        Score
Alice      25         89.5
Bob        30         72.3
```

### نکات کلیدی:

- **%s** برای چاپ رشته‌ها، **%d** برای اعداد صحیح، **%f** برای اعداد اعشاری.
- کنترل عرض فیلدها با `%10s`, `%-10s`, و غیره.
- استفاده از escape sequences برای کنترل دقیق‌تر چاپ.
- چاپ خروجی در فایل یا هدایت به خروجی استاندارد خطا.

## مثال: نوار بارگذاری به همراه درصد

در این بخش یک مثال از استفاده حرفه‌ای از دستور `printf` برای ایجاد یک نوار بارگذاری به همراه درصد نمایش داده می‌شود. این نوار به طور پیوسته در پایین ترمینال نمایش داده شده و همراه با پیشرفت عملیات، درصد بارگذاری نیز به‌روز می‌شود.

### اسکریپت نوار بارگذاری:

```bash
#!/bin/bash

# تابع برای بدست آوردن عرض ترمینال
get_terminal_width() {
    tput cols # تعداد ستون‌ها (عرض ترمینال) را بدست می‌آورد
}

# تابعی برای انتقال مکان‌نما به پایین صفحه
move_to_bottom() {
    local terminal_height
    terminal_height=$(tput lines)       # تعداد سطرهای ترمینال را بدست می‌آورد
    tput cup $((terminal_height - 1)) 0 # مکان‌نما را به آخرین خط می‌برد
}

# تابعی برای نمایش نوار بارگذاری به همراه درصد
show_loading_bar() {
    local progress=0
    local terminal_width
    terminal_width=$(get_terminal_width)         # عرض ترمینال (طول نوار بارگذاری)
    local loading_width=$((terminal_width - 10)) # طول نوار بارگذاری به همراه فضای درصد و کروشه‌ها

    move_to_bottom # انتقال مکان‌نما به پایین صفحه

    while [ "$progress" -le "$loading_width" ]; do
        # محاسبه درصد پیشرفت
        local percent=$((progress * 100 / loading_width))

        # رسم نوار بارگذاری
        printf "\r["
        local i=0
        while [ $i -lt $progress ]; do
            printf "="
            ((i++))
        done

        # رسم فلش و فضای خالی پس از نوار
        printf ">"
        local spaces=$((loading_width - progress))
        while [ $spaces -gt 0 ]; do
            printf " "
            ((spaces--))
        done

        # نمایش درصد به صورت ثابت در انتهای نوار
        printf "] %3d%%" "$percent"

        sleep 0.05 # تأخیر برای شبیه‌سازی عملیات
        ((progress++))
    done
    printf "\n" # اضافه کردن خط جدید پس از اتمام نوار
}

# شبیه‌سازی یک عملیات طولانی
clear # پاک کردن صفحه
echo "Running the proccess..."
show_loading_bar
echo "Operation is done!"
```

### توضیحات:

این اسکریپت از `printf` برای نمایش یک نوار بارگذاری استفاده می‌کند که به‌طور پیوسته در پایین ترمینال حرکت کرده و درصد پیشرفت عملیات را نشان می‌دهد.

1. **عرض نوار بارگذاری**: عرض نوار بارگذاری به اندازه عرض فعلی ترمینال تنظیم می‌شود. از تابع `tput cols` برای به دست آوردن تعداد ستون‌های ترمینال استفاده می‌شود. عرض نوار بارگذاری به گونه‌ای تنظیم شده که فضا برای نمایش درصد پیشرفت باقی بماند.

2. **محاسبه درصد پیشرفت**: درصد پیشرفت با استفاده از فرمول `(progress * 100 / loading_width)` محاسبه می‌شود و به صورت عددی در کنار نوار بارگذاری چاپ می‌شود.

3. **فلش و فضای خالی**: در نوار بارگذاری، یک فلش (`>`) برای نمایش پیشرفت نوار بعد از `=` ها قرار داده می‌شود، و بقیه‌ی فضای نوار با فاصله‌های خالی پر می‌شود تا در هر لحظه طول نوار با طول کل ترمینال همخوانی داشته باشد.

4. **استفاده از `tput` برای کنترل مکان‌نما**: این اسکریپت با استفاده از دستور `tput` مکان‌نما را به پایین صفحه منتقل کرده و به‌طور مرتب نوار بارگذاری را به‌روزرسانی می‌کند، به‌طوری که نوار همیشه در پایین ترمینال باقی بماند.

### نکات مهم:

- `tput cols` برای به دست آوردن عرض ترمینال و `tput lines` برای تعداد سطرهای ترمینال استفاده می‌شود.
- `%3d%%` در `printf`، درصد پیشرفت را با عرض ثابت (سه رقم) و همراه با علامت `%` نمایش می‌دهد.
- از `\r` برای بازگشت مکان‌نما به ابتدای خط استفاده شده تا نوار بارگذاری بازنویسی شود و خروجی آن به‌طور پیوسته به‌روزرسانی گردد.

### خروجی نهایی:

```
Running the proccess...

[============>                                  ] 23%
```

## جمع‌بندی

دستور `printf`یکی از ابزارهای قدرتمند برای فرمت‌دهی خروجی در Bash است. با استفاده از placeholderها، می‌توانید رشته‌ها، اعداد صحیح، اعداد اعشاری و مقادیر دیگر را به شکل دقیق و کنترل‌شده چاپ کنید. علاوه بر این،`printf`به شما امکان کنترل کامل روی عرض فیلدها، تراز کردن خروجی، و چاپ اعداد در مبناهای مختلف را می‌دهد. این ویژگی‌ها`printf` را به ابزاری عالی برای تولید خروجی‌های حرفه‌ای در اسکریپت‌های Bash تبدیل می‌کند.
