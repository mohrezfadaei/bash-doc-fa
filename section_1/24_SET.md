# راهنمای جامع و کامل برای دستور `set` در Bash

دستور `set` یکی از دستورات قدرتمند و انعطاف‌پذیر در Bash است که به شما امکان می‌دهد تنظیمات مختلفی را برای شل Bash پیکربندی کنید. با استفاده از این دستور، می‌توانید رفتار شل Bash را تغییر دهید، متغیرها و حالت‌های مختلفی را مدیریت کنید و خطایابی (debugging) را ساده‌تر کنید.

در این مستند، به بررسی کامل دستور `set`، گزینه‌های مختلف آن، و کاربردهای پیشرفته آن خواهیم پرداخت.

## 1. مقدمه‌ای بر دستور `set`

دستور `set` برای پیکربندی ویژگی‌ها و حالت‌های اجرای اسکریپت در Bash استفاده می‌شود. با استفاده از این دستور، می‌توانید رفتار شل را با استفاده از سوئیچ‌ها و پارامترهای مختلف تنظیم کنید. این دستور به شما امکان می‌دهد تا ویژگی‌هایی مانند فعال کردن حالت اشکال‌زدایی، کنترل بازگشت کدهای خطا، و تنظیمات مختلف دیگر را پیکربندی کنید.

### سینتکس کلی:

```bash
set [گزینه‌ها]
```

## 2. گزینه‌های پرکاربرد دستور `set`

### 2.1. `-e` (خروج در صورت بروز خطا)

گزینه `-e` باعث می‌شود که شل پس از مواجهه با هرگونه خطا در اجرای دستورات، به‌طور خودکار از اسکریپت خارج شود. این ویژگی به شما کمک می‌کند تا از اجرای دستورات بعدی پس از بروز خطا جلوگیری کنید.

#### مثال:

```bash
set -e
command1
command2  # اگر command1 خطا دهد، این دستور اجرا نمی‌شود.
```

### 2.2. `-x` (اشکال‌زدایی و نمایش دستورات)

گزینه `-x` به شما کمک می‌کند تا هنگام اجرای یک اسکریپت، هر دستور و نتیجه اجرای آن را مشاهده کنید. این گزینه برای خطایابی (debugging) مفید است.

#### مثال:

```bash
set -x
echo "This is a test"
```

در این مثال، هر دستور همراه با خروجی آن در ترمینال نمایش داده می‌شود.

### 2.3. `-v` (نمایش دستورات قبل از اجرا)

گزینه `-v` باعث می‌شود که هر دستور قبل از اجرای آن در خروجی چاپ شود. برخلاف `-x` که هم دستور و هم خروجی را نمایش می‌دهد، `-v` فقط دستورات را قبل از اجرا نمایش می‌دهد.

#### مثال:

```bash
set -v
echo "Hello World"
```

### 2.4. `-u` (خطا در صورت استفاده از متغیرهای تعریف نشده)

گزینه `-u` باعث می‌شود که اگر در اسکریپت از متغیری استفاده شود که تعریف نشده است، خطا ایجاد شود. این گزینه برای جلوگیری از استفاده ناخواسته از متغیرهای خالی یا نادرست بسیار مفید است.

#### مثال:

```bash
set -u
echo "متغیر: $undefined_var"  # خطا ایجاد می‌شود زیرا متغیر تعریف نشده است.
```

### 2.5. `-o pipefail` (بررسی خطاها در پایپ‌ها)

گزینه `-o pipefail` باعث می‌شود که اگر هرکدام از دستورات در یک زنجیره پایپ (pipe) با خطا مواجه شوند، کد خروجی خطا برگشت داده شود. این گزینه به شما کمک می‌کند تا خطاهای مخفی در پایپ‌ها را شناسایی کنید.

#### مثال:

```bash
set -o pipefail
command1 | command2 | command3  # اگر هر کدام خطا دهند، اسکریپت خطا می‌دهد.
```

### 2.6. `+e`، `+x`، و دیگر غیرفعال‌سازی‌ها

برای غیرفعال کردن هر گزینه‌ای که فعال شده است، می‌توانید از نسخه با علامت مثبت آن گزینه استفاده کنید. مثلاً برای غیرفعال کردن `-e` از `+e` استفاده می‌کنیم.

#### مثال:

```bash
set -e  # فعال کردن خروج در صورت بروز خطا
set +e  # غیرفعال کردن آن
```

## 3. استفاده از دستور `set` برای مدیریت پارامترها

### 3.1. مشاهده لیست پارامترها و متغیرهای محیطی

اگر دستور `set` را بدون هیچ گزینه‌ای اجرا کنید، لیست تمام متغیرهای محیطی و پارامترهای تعریف‌شده در شل نمایش داده می‌شود.

#### مثال:

```bash
set
```

### 3.2. تنظیم پارامترها با `set`

شما می‌توانید پارامترها و متغیرها را با استفاده از دستور `set` تنظیم کنید. برای مثال، می‌توانید مقادیر آرگومان‌های یک اسکریپت را تغییر دهید.

#### مثال:

```bash
set -- arg1 arg2 arg3
echo "$1"  # خروجی: arg1
```

در این مثال، آرگومان‌های اسکریپت به `arg1`، `arg2` و `arg3` تنظیم شده‌اند.

## 4. حالت‌های پیشرفته دستور `set`

### 4.1. `-n` (تجزیه و تحلیل بدون اجرا)

گزینه `-n` باعث می‌شود که اسکریپت تنها تجزیه و تحلیل (parsing) شود ولی اجرا نشود. این گزینه برای بررسی صحت ساختار اسکریپت بدون اجرای آن مفید است.

#### مثال:

```bash
set -n
echo "این دستور اجرا نخواهد شد"
```

### 4.2. `-f` (غیرفعال کردن توسعه نام فایل‌ها)

گزینه `-f` باعث می‌شود که توسعه نام فایل‌ها (globbing) غیرفعال شود. در این حالت، کاراکترهایی مانند `*` و `?` به‌عنوان رشته‌های معمولی در نظر گرفته می‌شوند.

#### مثال:

```bash
set -f
echo *  # بدون توسعه نام فایل‌ها چاپ می‌شود.
```

### 4.3. `-C` (جلوگیری از بازنویسی فایل‌ها)

گزینه `-C` مانع از بازنویسی فایل‌های موجود هنگام استفاده از `>` برای تغییر مسیر خروجی می‌شود. اگر فایل وجود داشته باشد، بازنویسی نخواهد شد.

#### مثال:

```bash
set -C
echo "Hello" > file.txt  # اگر فایل وجود داشته باشد، خطا رخ می‌دهد.
```

### 4.4. `-T` (فعال کردن ردیابی توابع)

گزینه `-T` ردیابی توابع را فعال می‌کند. این گزینه به شما امکان می‌دهد که هنگام اجرای توابع، فرآیندها را به‌طور دقیق‌تری دنبال کنید.

#### مثال:

```bash
set -T
function test_function() {
  echo "Executing function"
}
test_function
```

## 5. ترکیب گزینه‌ها

شما می‌توانید چندین گزینه `set` را به صورت همزمان استفاده کنید. برای مثال، می‌توانید همزمان از گزینه‌های `-e` و `-x` برای متوقف کردن اجرای اسکریپت در صورت بروز خطا و نمایش دستورات استفاده کنید.

#### مثال:

```bash
set -e -x
command1
command2
```

## 6. تفاوت `set` و `export`

گاهی اوقات، `set` با دستور `export` اشتباه گرفته می‌شود. تفاوت اصلی این است که `set` برای تنظیم رفتار شل و پارامترهای آن استفاده می‌شود، در حالی که `export` برای تعریف متغیرهایی که به فرآیندهای فرزند منتقل می‌شوند به کار می‌رود.

### مثال:

```bash
export VAR="value"  # متغیر به فرآیندهای فرزند منتقل می‌شود.
set VAR="value"     # متغیر در اسکریپت جاری تنظیم می‌شود.
```

## جمع‌بندی

دستور `set` در Bash یکی از دستورات کلیدی و انعطاف‌پذیر برای مدیریت رفتار شل و اسکریپت‌ها است. با استفاده از گزینه‌های مختلف آن، می‌توانید خطایابی، مدیریت خروجی‌ها و ورودی‌ها، و تنظیم پارامترها را به‌شکل کارآمدی انجام دهید. این دستور به شما این امکان را می‌دهد که کنترل دقیقی بر رفتار اسکریپت‌های Bash خود داشته باشید و اجرای آن‌ها را بهینه‌تر کنید.

### جدول خلاصه گزینه‌های پرکاربرد دستور `set`

### جدول خلاصه گزینه‌های پرکاربرد دستور `set` در Bash

| گزینه         | توضیحات                                                                            |
| ------------- | ---------------------------------------------------------------------------------- |
| `-e`          | خروج از اسکریپت در صورت بروز خطا. اگر دستوری خطا دهد، اجرای اسکریپت متوقف می‌شود.  |
| `-x`          | نمایش دستورات و خروجی آن‌ها برای خطایابی (Debugging).                              |
| `-v`          | نمایش دستورات قبل از اجرا.                                                         |
| `-u`          | ایجاد خطا در صورت استفاده از متغیرهای تعریف نشده.                                  |
| `-o pipefail` | بازگرداندن کد خطا در صورت بروز خطا در هر دستور از زنجیره پایپ.                     |
| `-n`          | تجزیه و تحلیل اسکریپت بدون اجرا. مناسب برای بررسی خطاها بدون اجرای دستورات.        |
| `-f`          | غیرفعال کردن توسعه نام فایل‌ها (globbing)؛ از تفسیر `*` و `?` جلوگیری می‌کند.      |
| `-C`          | جلوگیری از بازنویسی فایل‌ها هنگام استفاده از `>`؛ اگر فایل موجود باشد، خطا می‌دهد. |
| `+e`          | غیرفعال کردن خروج از اسکریپت در صورت بروز خطا (غیرفعال‌سازی `-e`).                 |
| `+x`          | غیرفعال کردن حالت اشکال‌زدایی (غیرفعال‌سازی `-x`).                                 |
