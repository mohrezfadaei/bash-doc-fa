# راهنمای جامع و کامل درباره File Descriptor‌ها در Bash

در سیستم‌عامل‌های شبه یونیکس مانند لینوکس، مفهومی به نام **File Descriptor** (فایل دسکریپتور) وجود دارد که به کمک آن سیستم‌عامل و برنامه‌ها می‌توانند با منابع ورودی و خروجی مانند فایل‌ها، دستگاه‌ها و شبکه ارتباط برقرار کنند. هر فایل باز شده، عملیات ورودی/خروجی، یا منابعی از این نوع یک فایل دسکریپتور مختص به خود دارد.

در این مستند، به صورت جامع به بررسی مفاهیم، کاربردها و نحوه کار با فایل دسکریپتور‌ها در Bash خواهیم پرداخت.

## 1. فایل دسکریپتور چیست؟

**File Descriptor** یک عدد صحیح است که به عنوان شناسه یک منبع ورودی یا خروجی استفاده می‌شود. هر فرآیند در سیستم‌عامل، به هنگام باز کردن یک فایل یا عملیات مشابه، یک فایل دسکریپتور منحصر به فرد دریافت می‌کند. این عدد به سیستم‌عامل می‌گوید که چه منبعی باید خوانده یا نوشته شود.

### سه فایل دسکریپتور استاندارد:

1. **0 - Standard Input (stdin)**: ورودی استاندارد که به طور پیش‌فرض از صفحه کلید داده‌ها را می‌گیرد.
2. **1 - Standard Output (stdout)**: خروجی استاندارد که به طور پیش‌فرض خروجی‌ها را به صفحه نمایش ارسال می‌کند.
3. **2 - Standard Error (stderr)**: خروجی خطاهای استاندارد که پیام‌های خطا را به صفحه نمایش ارسال می‌کند.

| File Descriptor | توضیحات                         | پیش‌فرض    |
| --------------- | ------------------------------- | ---------- |
| `0`             | ورودی استاندارد (stdin)         | صفحه کلید  |
| `1`             | خروجی استاندارد (stdout)        | صفحه نمایش |
| `2`             | خروجی خطاهای استاندارد (stderr) | صفحه نمایش |

## 2. تغییر مسیر (Redirection) در Bash

با استفاده از فایل دسکریپتور‌ها می‌توان مسیر ورودی و خروجی دستورات را تغییر داد. به این عملیات **تغییر مسیر** یا **Redirection** گفته می‌شود. در این حالت، ورودی‌ها یا خروجی‌ها به منابع دیگری مانند فایل‌ها یا دستگاه‌های مختلف هدایت می‌شوند.

### 2.1. تغییر مسیر خروجی استاندارد (stdout)

برای تغییر مسیر خروجی استاندارد از `>` استفاده می‌شود. به این ترتیب، خروجی دستور به جای نمایش در صفحه، به یک فایل ارسال می‌شود.

#### مثال:

```bash
echo "Hello World" > output.txt
```

در این مثال، خروجی دستور `echo` که به‌طور معمول در صفحه نمایش داده می‌شد، به فایل `output.txt` هدایت می‌شود.

### 2.2. تغییر مسیر خطای استاندارد (stderr)

برای تغییر مسیر خطای استاندارد از `2>` استفاده می‌شود. به این ترتیب، پیام‌های خطا به یک فایل یا منبع دیگر هدایت می‌شوند.

#### مثال:

```bash
ls /nonexistent_folder 2> errors.txt
```

در این مثال، خطای ناشی از عدم وجود دایرکتوری به جای نمایش در صفحه، به فایل `errors.txt` هدایت می‌شود.

### 2.3. تغییر مسیر خروجی و خطا به یک فایل

برای هدایت هر دو خروجی استاندارد و خطای استاندارد به یک فایل، از `&>` یا ترکیب `1>` و `2>` استفاده می‌شود.

#### مثال:

```bash
command &> output.txt
```

یا:

```bash
command > output.txt 2>&1
```

در هر دو حالت، هم خروجی استاندارد و هم پیام‌های خطا به فایل `output.txt` هدایت می‌شوند.

### 2.4. تغییر مسیر ورودی استاندارد (stdin)

برای تغییر مسیر ورودی استاندارد از `<` استفاده می‌شود. این عملیات باعث می‌شود که ورودی یک دستور از یک فایل گرفته شود به جای اینکه از صفحه کلید دریافت شود.

#### مثال:

```bash
cat < input.txt
```

در این مثال، محتوای فایل `input.txt` به دستور `cat` به عنوان ورودی داده می‌شود.

## 3. مدیریت فایل دسکریپتورهای سفارشی

علاوه بر فایل دسکریپتورهای استاندارد (0، 1، 2)، شما می‌توانید فایل دسکریپتورهای سفارشی برای خواندن و نوشتن از منابع مختلف ایجاد کنید.

### 3.1. باز کردن یک فایل برای خواندن و نوشتن

می‌توانید فایل دسکریپتوری سفارشی ایجاد کنید و آن را به یک فایل باز اختصاص دهید. برای این کار از نماد `exec` استفاده می‌شود.

#### مثال:

```bash
exec 3> output.txt
echo "Hello" >&3
```

در این مثال، فایل دسکریپتور `3` به فایل `output.txt` اختصاص داده شده و خروجی دستور `echo` به جای صفحه نمایش به فایل ارسال می‌شود.

### 3.2. بستن فایل دسکریپتور سفارشی

پس از اتمام کار با یک فایل دسکریپتور سفارشی، می‌توانید آن را با استفاده از `exec` ببندید.

#### مثال:

```bash
exec 3>&-
```

در این مثال، فایل دسکریپتور `3` بسته شده و دیگر نمی‌تواند به فایل `output.txt` دسترسی داشته باشد.

## 4. تغییر مسیر فایل دسکریپتورهای سفارشی

شما می‌توانید فایل دسکریپتورهای سفارشی را مانند فایل دسکریپتورهای استاندارد تغییر مسیر دهید. به عنوان مثال، می‌توانید خطاهای یک دستور را به فایل دسکریپتور سفارشی هدایت کنید.

#### مثال:

```bash
exec 3> errors.txt
command 2>&3
```

در این مثال، خطاهای دستور `command` به فایل دسکریپتور `3` که به فایل `errors.txt` مرتبط است، هدایت می‌شوند.

## 5. نکات و ترفندها

### 5.1. ترکیب `stderr` و `stdout` در یک فایل

برای ترکیب خروجی استاندارد و خطاهای استاندارد در یک فایل، می‌توانید از روش زیر استفاده کنید:

#### مثال:

```bash
command > all_output.txt 2>&1
```

### 5.2. افزودن خروجی به فایل

برای اضافه کردن خروجی به انتهای یک فایل به جای بازنویسی آن، می‌توانید از `>>` استفاده کنید.

#### مثال:

```bash
echo "New Line" >> output.txt
```

### 5.3. هدایت خطاها به `/dev/null`

گاهی اوقات ممکن است بخواهید پیام‌های خطا نادیده گرفته شوند. در این موارد می‌توانید خروجی خطا را به `/dev/null` هدایت کنید.

#### مثال:

```bash
command 2> /dev/null
```

در این مثال، هرگونه خطای ایجاد شده توسط `command` نادیده گرفته می‌شود و به `/dev/null` هدایت می‌شود.

### 5.4. استفاده از فایل دسکریپتور در اسکریپت‌های پیچیده

فایل دسکریپتورها ابزار قدرتمندی برای کنترل ورودی و خروجی دستورات در اسکریپت‌های پیچیده هستند. با استفاده از فایل دسکریپتورهای سفارشی، می‌توانید جریان ورودی و خروجی را دقیق‌تر مدیریت کنید.

## جمع‌بندی

**File Descriptor**‌ها در سیستم‌های شبه یونیکس نقش کلیدی در مدیریت منابع ورودی و خروجی ایفا می‌کنند. با درک عمیق‌تر نحوه کار با این فایل دسکریپتور‌ها، شما می‌توانید اسکریپت‌های Bash پیچیده‌تر و مؤثرتری بنویسید. از قابلیت‌های تغییر مسیر (Redirection) برای هدایت خروجی و خطاها به منابع مختلف استفاده کنید و فایل دسکریپتورهای سفارشی را برای کنترل دقیق‌تر ورودی‌ها و خروجی‌ها به کار ببرید.

### جدول خلاصه فایل دسکریپتورها

| File Descriptor | توضیحات                         | پیش‌فرض    |
| --------------- | ------------------------------- | ---------- |
| `0`             | ورودی استاندارد (stdin)         | صفحه کلید  |
| `1`             | خروجی استاندارد (stdout)        | صفحه نمایش |
| `2`             | خروجی خطاهای استاندارد (stderr) | صفحه نمایش |

### دستورات رایج:

| عملیات                         | دستور                     | توضیحات                                |
| ------------------------------ | ------------------------- | -------------------------------------- |
| تغییر مسیر خروجی استاندارد     | `command > file.txt`      | هدایت خروجی استاندارد به فایل          |
| تغییر مسیر خطاهای استاندارد    | `command 2> file.txt`     | هدایت خطاها به فایل                    |
| هدایت خطاها به خروجی استاندارد | `command > file.txt 2>&1` | هدایت خروجی و خطاها به یک فایل         |
| باز کردن فایل دسکریپتور سفارشی | `exec 3> output.txt`      | ایجاد فایل دسکریپتور سفارشی برای خروجی |
| بستن فایل دسکریپتور سفارشی     | `exec 3>&-`               | بستن فایل دسکریپتور سفارشی             |

در Bash، فایل دسکریپتورها به طرق مختلف قابل استفاده و تغییر هستند. در زیر یک جدول جامع از تمام حالات و ترفندهای مرتبط با استفاده از فایل دسکریپتور‌ها در Bash آورده شده است. این جدول به شما کمک می‌کند تا تمامی روش‌های هدایت ورودی و خروجی، مدیریت خطاها و ایجاد فایل دسکریپتورهای سفارشی را به شکل کارآمدتری درک کنید.

### جدول کامل حالات و ترفندهای فایل دسکریپتور‌ها در Bash:

| عملیات                                      | دستور Bash                          | توضیحات                                                                                 |
| ------------------------------------------- | ----------------------------------- | --------------------------------------------------------------------------------------- |
| تغییر مسیر خروجی استاندارد                  | `command > file.txt`                | خروجی استاندارد (stdout) به فایل `file.txt` هدایت می‌شود.                               |
| اضافه کردن به خروجی                         | `command >> file.txt`               | خروجی استاندارد به انتهای فایل `file.txt` اضافه می‌شود، بدون بازنویسی.                  |
| تغییر مسیر خطاهای استاندارد                 | `command 2> error.txt`              | خروجی خطا (stderr) به فایل `error.txt` هدایت می‌شود.                                    |
| ترکیب خروجی و خطا به یک فایل                | `command > file.txt 2>&1`           | خروجی استاندارد و خطاها به فایل `file.txt` هدایت می‌شوند.                               |
| تغییر مسیر ورودی استاندارد                  | `command < input.txt`               | ورودی استاندارد (stdin) از فایل `input.txt` خوانده می‌شود.                              |
| تغییر مسیر خطاها به خروجی                   | `command 2>&1`                      | خطاهای استاندارد به خروجی استاندارد هدایت می‌شود.                                       |
| هدایت همه خروجی‌ها به `/dev/null`           | `command > /dev/null 2>&1`          | خروجی‌ها و خطاها به `/dev/null` هدایت می‌شوند (نادیده گرفته می‌شوند).                   |
| ایجاد فایل دسکریپتور سفارشی                 | `exec 3> custom_output.txt`         | فایل دسکریپتور `3` به فایل `custom_output.txt` متصل می‌شود.                             |
| نوشتن با فایل دسکریپتور سفارشی              | `echo "Custom output" >&3`          | خروجی دستور `echo` به فایل دسکریپتور `3` ارسال می‌شود.                                  |
| بستن فایل دسکریپتور سفارشی                  | `exec 3>&-`                         | فایل دسکریپتور `3` بسته می‌شود و ارتباط آن قطع می‌شود.                                  |
| هدایت خطاها به فایل دسکریپتور سفارشی        | `command 2>&3`                      | خطاهای استاندارد به فایل دسکریپتور `3` هدایت می‌شود.                                    |
| باز کردن فایل برای خواندن                   | `exec 3< input.txt`                 | فایل `input.txt` برای خواندن با فایل دسکریپتور `3` باز می‌شود.                          |
| خواندن از فایل دسکریپتور سفارشی             | `read line <&3`                     | ورودی از فایل دسکریپتور `3` خوانده می‌شود.                                              |
| هدایت خطاها و خروجی به فایل‌های مختلف       | `command > output.txt 2> error.txt` | خروجی استاندارد به `output.txt` و خطاها به `error.txt` هدایت می‌شود.                    |
| هدایت خروجی به یک فایل و خطا به `/dev/null` | `command > output.txt 2> /dev/null` | خروجی استاندارد به فایل و خطاها نادیده گرفته می‌شوند.                                   |
| هدایت خروجی استاندارد به پایپ               | `command 1> >(command2)`            | خروجی استاندارد به ورودی دستور دیگر از طریق پایپ هدایت می‌شود.                          |
| هدایت خطا به پایپ                           | `command 2> >(command2)`            | خطاهای استاندارد به ورودی دستور دیگر از طریق پایپ هدایت می‌شود.                         |
| بستن هر دو فایل دسکریپتور خروجی و خطا       | `command > output.txt 2>&-`         | خروجی استاندارد به فایل هدایت می‌شود و خطاها بسته می‌شوند (خطاها نادیده گرفته می‌شوند). |

### توضیحات:

1. **تغییر مسیر ورودی/خروجی**: با استفاده از `>` و `<`، می‌توانید ورودی و خروجی استاندارد فرآیندها را به فایل‌ها، دستگاه‌ها یا منابع دیگر هدایت کنید.
2. **فایل دسکریپتورهای سفارشی**: با استفاده از دستور `exec`، فایل دسکریپتورهای سفارشی ایجاد می‌کنید و می‌توانید آن‌ها را برای خواندن و نوشتن به منابع مختلف استفاده کنید.
3. **ترکیب ورودی و خروجی**: می‌توانید خطاها و خروجی استاندارد را با هم ترکیب کرده و به یک فایل یا منبع هدایت کنید. همچنین، می‌توانید خطاها و خروجی‌ها را به منابع متفاوتی هدایت کنید.
4. **استفاده از `/dev/null`**: زمانی که می‌خواهید خروجی‌ها و خطاها را نادیده بگیرید، می‌توانید آن‌ها را به `/dev/null` هدایت کنید که به‌عنوان یک "سیاه‌چاله" برای حذف خروجی‌ها و خطاها عمل می‌کند.
