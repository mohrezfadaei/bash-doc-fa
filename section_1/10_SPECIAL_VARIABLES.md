# راهنمای جامع و کامل درباره Special Variables در Bash

در Bash، متغیرهای خاص (Special Variables) متغیرهایی هستند که Bash به صورت داخلی برای مدیریت رفتار اسکریپت‌ها و فرامین استفاده می‌کند. این متغیرها مقادیر خاصی مانند آرگومان‌های خط فرمان، وضعیت خروجی دستورات، و PID (شناسه فرآیند) را در خود نگه می‌دارند و به کاربران و اسکریپت‌نویسان اجازه می‌دهند که به اطلاعات مهمی دسترسی پیدا کنند.

در این راهنما، به تمامی Special Variables موجود در Bash پرداخته و نکات و ترفندهای مرتبط با آنها را توضیح خواهیم داد.

## لیست متغیرهای خاص (Special Variables)

### 1. `$0`

این متغیر نام اسکریپت جاری را نگه می‌دارد. وقتی یک اسکریپت Bash اجرا می‌شود، `$0` نام فایل اسکریپت را باز می‌گرداند.

### مثال:

```bash
#!/bin/bash
echo "Script name: $0"
```

### نکته:

- اگر اسکریپت با مسیر کامل اجرا شود، `$0` نیز مسیر کامل را نشان می‌دهد. به عنوان مثال، اگر اسکریپت به شکل `/home/user/script.sh` اجرا شود، مقدار `$0` برابر با `/home/user/script.sh` خواهد بود.

### 2. `$1`, `$2`, ..., `$N`

این متغیرها آرگومان‌های خط فرمان را نگه می‌دارند. `$1` اولین آرگومان، `$2` دومین آرگومان و به همین ترتیب تا `$N` که Nام آرگومان را نشان می‌دهد.

### مثال:

```bash
#!/bin/bash
echo "First argument: $1"
echo "Second argument: $2"
```

### نکته:

- اگر تعداد آرگومان‌ها بیشتر از 9 باشد، می‌توانید از `${10}` و بالاتر برای دسترسی به آرگومان‌های بعدی استفاده کنید.

### 3. `$#`

این متغیر تعداد آرگومان‌های پاس داده شده به اسکریپت را نشان می‌دهد. این متغیر برای بررسی اینکه آیا تعداد کافی آرگومان به اسکریپت داده شده است یا خیر بسیار مفید است.

### مثال:

```bash
#!/bin/bash
echo "Number of arguments: $#"
```

### نکته:

- این متغیر تنها تعداد آرگومان‌ها را بازمی‌گرداند و مقادیر آنها را نشان نمی‌دهد.

### 4. `$@` و `$*`

این متغیرها تمام آرگومان‌های خط فرمان را به صورت یک رشته نمایش می‌دهند، اما با تفاوت‌های ظریف:

- **`$@`**: آرگومان‌ها را به صورت جداگانه درون دابل کوتیشن‌ها (`""`) باز می‌گرداند.
- **`$*`**: تمام آرگومان‌ها را به عنوان یک رشته واحد باز می‌گرداند.

### مثال:

```bash
#!/bin/bash
echo "Using \$@:"
for arg in "$@"; do
  echo "$arg"
done

echo "Using \$*:"
for arg in "$*"; do
  echo "$arg"
done
```

### نکته:

- **`$@`** بیشتر برای استفاده در حلقه‌های `for` مناسب است، چرا که هر آرگومان به صورت جداگانه پردازش می‌شود.
- **`$*`** تمام آرگومان‌ها را به عنوان یک رشته واحد بازمی‌گرداند و برای کاربردهای خاص مناسب‌تر است.

### 5. `$?`

این متغیر وضعیت خروجی آخرین دستور اجرا شده را نگه می‌دارد. اگر دستور قبلی موفقیت‌آمیز باشد، مقدار `$?` برابر با `0` است، و اگر با خطا مواجه شده باشد، مقدار آن یک عدد غیر صفر خواهد بود.

### مثال:

```bash
#!/bin/bash
ls /nonexistent_directory
echo "Exit status of last command: $?"
```

### نکته:

- `$?` به طور معمول برای بررسی وضعیت اجرای دستورات و اسکریپت‌ها استفاده می‌شود تا مشخص شود که آیا دستورات با موفقیت اجرا شده‌اند یا خیر.

### 6. `$$`

این متغیر شناسه فرآیند (PID) اسکریپت جاری را نشان می‌دهد. هر فرآیند در سیستم لینوکس یک شناسه فرآیند منحصربه‌فرد دارد و با استفاده از `$$` می‌توانید به آن دسترسی پیدا کنید.

### مثال:

```bash
#!/bin/bash
echo "Process ID: $$"
```

### نکته:

- از این متغیر می‌توانید برای ایجاد فایل‌های موقت که نام آنها بر اساس شناسه فرآیند منحصر به فرد باشد، استفاده کنید.

### 7. `$!`

این متغیر PID آخرین فرآیندی که به صورت پس‌زمینه اجرا شده است را برمی‌گرداند. وقتی دستوری را به پس‌زمینه منتقل می‌کنید، `$!` شناسه آن را نگه می‌دارد.

### مثال:

```bash
#!/bin/bash
sleep 60 &
echo "PID of the background process: $!"
```

### نکته:

- `$!` بسیار مفید است وقتی می‌خواهید فرآیندهای پس‌زمینه را کنترل یا متوقف کنید.

### 8. `$_`

این متغیر آخرین آرگومان استفاده شده توسط دستور قبلی را نشان می‌دهد. به طور معمول، `$_` آخرین مقدار چاپ شده یا آخرین آرگومان از دستوری که اجرا شده است را باز می‌گرداند.

### مثال:

```bash
#!/bin/bash
echo "First argument: $1"
echo "Using \$_: $_"
```

### نکته:

- این متغیر برای استفاده در دستورات تکراری یا برای دسترسی سریع به آخرین آرگومان کاربردی است.

## نکات و ترفندها در استفاده از Special Variables

### 1. بررسی تعداد آرگومان‌ها

با استفاده از `$#` می‌توانید بررسی کنید که آیا تعداد درستی از آرگومان‌ها به اسکریپت داده شده است یا خیر.

```bash
#!/bin/bash
if [ $# -lt 2 ]; then
  echo "Usage: $0 <arg1> <arg2>"
  exit 1
fi
```

### 2. استفاده از `$@` برای پردازش آرگومان‌ها

وقتی می‌خواهید آرگومان‌ها را به صورت جداگانه پردازش کنید، استفاده از `$@` بسیار مناسب است.

```bash
for arg in "$@"; do
  echo "Processing argument: $arg"
done
```

### 3. استفاده از `$$` برای ایجاد فایل‌های موقت

از `$$` می‌توانید برای ایجاد فایل‌های موقت با نام منحصربه‌فرد استفاده کنید تا از تداخل با دیگر فایل‌ها جلوگیری شود.

```bash
#!/bin/bash
temp_file="/tmp/tempfile_$$.txt"
echo "Creating temporary file: $temp_file"
touch "$temp_file"
```

### 4. کنترل فرآیندهای پس‌زمینه با `$!`

می‌توانید از `$!` برای کنترل و مدیریت فرآیندهای پس‌زمینه استفاده کنید.

```bash
#!/bin/bash
long_running_task &
task_pid=$!
echo "Task is running in background with PID: $task_pid"
wait $task_pid
echo "Task finished."
```

### 5. بررسی وضعیت خروجی با `$?`

از `$?` می‌توانید برای بررسی وضعیت اجرای دستورات و تصمیم‌گیری در ادامه اسکریپت استفاده کنید.

```bash
#!/bin/bash
command
if [ $? -eq 0 ]; then
  echo "Command succeeded."
else
  echo "Command failed."
fi
```

## جدول Special Variables در Bash

| متغیر           | توضیحات                                                                                      | مثال                                          |
| --------------- | -------------------------------------------------------------------------------------------- | --------------------------------------------- |
| `$0`            | نام اسکریپت جاری را نگه می‌دارد                                                              | `echo "Script name: $0"`                      |
| `$1`, `$2`, ... | آرگومان‌های خط فرمان را نگه می‌دارند. `$1` اولین آرگومان و `$N` آرگومان Nام را نمایش می‌دهد. | `echo "First argument: $1"`                   |
| `$#`            | تعداد آرگومان‌های پاس داده شده به اسکریپت را نشان می‌دهد.                                    | `echo "Number of arguments: $#"`              |
| `$@`            | تمام آرگومان‌ها را به صورت جداگانه درون دابل کوتیشن‌ها باز می‌گرداند.                        | `for arg in "$@"; do echo "$arg"; done`       |
| `$*`            | تمام آرگومان‌ها را به عنوان یک رشته واحد باز می‌گرداند.                                      | `for arg in "$*"; do echo "$arg"; done`       |
| `$?`            | وضعیت خروجی آخرین دستور را باز می‌گرداند.                                                    | `ls /nonexistent_dir; echo "Exit status: $?"` |
| `$$`            | شناسه فرآیند (PID) اسکریپت جاری را نشان می‌دهد.                                              | `echo "Process ID: $$"`                       |
| `$!`            | شناسه آخرین فرآیندی که به پس‌زمینه ارسال شده است را نگه می‌دارد.                             | `sleep 60 & echo "Background PID: $!"`        |
| `$_`            | آخرین آرگومان از دستور قبلی یا آخرین مقدار چاپ شده را نشان می‌دهد.                           | `echo "Last argument: $_"`                    |

### توضیحات تکمیلی:

- **`$0`**: می‌تواند مسیر کامل اسکریپت را نمایش دهد.
- **`$#`**: برای بررسی تعداد صحیح آرگومان‌ها قبل از اجرای عملیات اصلی استفاده می‌شود.
- **`$@`**: هر آرگومان را جداگانه درون یک حلقه پردازش می‌کند.
- **`$?`**: برای بررسی موفقیت یا شکست یک دستور استفاده می‌شود.
- **`$$`**: برای ایجاد فایل‌های موقت با نام منحصربه‌فرد براساس PID کاربرد دارد.

این جدول متغیرهای خاص Bash را به‌طور خلاصه توضیح می‌دهد و مثال‌های کاربردی برای هرکدام ارائه می‌دهد.

## جمع‌بندی

Special Variables در Bash ابزارهایی قدرتمند برای مدیریت و کنترل اسکریپت‌ها هستند. آنها اطلاعات مهمی مانند آرگومان‌های خط فرمان، وضعیت اجرای دستورات، شناسه فرآیندها، و بسیاری از داده‌های دیگر را فراهم می‌کنند که در بهبود کیفیت و کارایی اسکریپت‌های شما مؤثرند.
