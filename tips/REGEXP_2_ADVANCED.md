````markdown
# راهنمای جامع و پیشرفته Regular Expression

**Regular Expression** یا **Regex** در سطح پیشرفته می‌تواند ابزار بسیار قدرتمندی برای جستجو و مدیریت الگوهای پیچیده متنی باشد. Regex در سطوح مختلفی از زبان‌های برنامه‌نویسی، ابزارهای خط فرمان (مانند `sed` و `awk`)، و حتی برخی محیط‌های گرافیکی استفاده می‌شود. در این راهنما، به بررسی مفاهیم پیشرفته Regex خواهیم پرداخت که به شما امکان می‌دهند تا با الگوهای پیچیده‌تر و دقیق‌تری کار کنید.

## 1. گروه‌بندی پیشرفته و بازیابی

در سطح پیشرفته، Regex امکان استفاده از گروه‌بندی‌ها و بازخوانی آن‌ها را به شما می‌دهد.

### 1.1. گروه‌های نام‌گذاری شده

گروه‌های نام‌گذاری شده با استفاده از `(?<name>...)` تعریف می‌شوند. این گروه‌ها به شما امکان می‌دهند تا قسمت‌های مختلفی از الگو را با نام مشخص ذخیره کنید و بعداً از این نام‌ها استفاده کنید.

#### مثال:

```regex
(?<username>\w+)@(?<domain>\w+\.\w+)
```
````

در این الگو، `username` و `domain` گروه‌های نام‌گذاری شده هستند که نام کاربری و دامنه یک ایمیل را جدا می‌کنند.

### 1.2. بازخوانی گروه‌ها

در Regex‌های پیشرفته، می‌توانید از گروه‌های قبلی بازخوانی کنید. این کار به‌صورت `\1`, `\2` و ... یا با نام گروه مانند `\k<name>` انجام می‌شود.

#### مثال:

```regex
(?<word>\w+)\s+\k<word>
```

این الگو به دنبال دو کلمه تکراری است (مثل `hello hello`).

## 2. تطبیق‌های غیرحریصانه (Lazy Matching)

در تطبیق‌های معمولی، Regex به‌صورت حریصانه عمل می‌کند؛ یعنی تا جایی که می‌تواند الگو را تطبیق می‌دهد. با استفاده از `?` پس از یک عملگر تکرار (مثل `*`, `+`, `{}`)، می‌توانید آن را غیرحریصانه کنید تا تطبیق با کمترین تعداد ممکن انجام شود.

#### مثال:

```regex
<a.*?>content</a>
```

این الگو فقط اولین تگ `<a>` را تا اولین بسته شدن `</a>` تطبیق می‌دهد.

## 3. بررسی مثبت و منفی (Lookahead و Lookbehind)

**Lookahead** و **Lookbehind** به شما امکان می‌دهند الگوهایی را تطبیق دهید که در مجاورت یک الگوی خاص باشند، بدون اینکه آن‌ها را به‌عنوان بخشی از تطبیق در نظر بگیرند.

### 3.1. Lookahead مثبت `(?=...)`

الگویی که درون `(?=...)` نوشته شود، به دنبال عبارتی که پس از آن تطبیق دارد می‌گردد.

#### مثال:

```regex
\w+(?=\s+example)
```

این الگو هر کلمه‌ای را که قبل از عبارت `example` قرار دارد تطبیق می‌دهد.

### 3.2. Lookahead منفی `(?!...)`

این تطبیق زمانی اتفاق می‌افتد که الگوی بعدی وجود نداشته باشد.

#### مثال:

```regex
\w+(?!\s+example)
```

این الگو هر کلمه‌ای که بعد از آن `example` نیامده باشد را تطبیق می‌دهد.

### 3.3. Lookbehind مثبت `(?<=...)`

این نوع تطبیق بررسی می‌کند که آیا قبل از الگوی مورد نظر، یک عبارت مشخص وجود دارد یا خیر.

#### مثال:

```regex
(?<=\$)\d+
```

این الگو به دنبال یک عدد می‌گردد که قبل از آن علامت `$` باشد.

### 3.4. Lookbehind منفی `(?<!...)`

در این نوع تطبیق، اگر قبل از الگو عبارت خاصی وجود نداشته باشد، تطبیق انجام می‌شود.

#### مثال:

```regex
(?<!\$)\d+
```

این الگو به دنبال اعدادی می‌گردد که قبل از آن‌ها علامت `$` نباشد.

## 4. عبارات شرطی

در Regex، می‌توان از عبارات شرطی برای اجرای تطبیق‌های وابسته به شرایط خاص استفاده کرد. این امکان با استفاده از ساختار `(?ifthen|else)` فراهم می‌شود.

#### مثال:

```regex
(?(\d{4})\d{4}|\d{2})
```

این الگو بررسی می‌کند که اگر ورودی چهار عدد باشد، فقط چهار عدد را تطبیق دهد؛ و در غیر این صورت، دو عدد را بگیرد.

## 5. استفاده از فلگ‌ها و گزینه‌ها

فلگ‌ها و گزینه‌ها در Regex به شما امکان می‌دهند که تنظیمات خاصی را اعمال کنید. این فلگ‌ها می‌توانند در بسیاری از زبان‌ها و ابزارها استفاده شوند.

| فلگ | توضیحات                                             |
| --- | --------------------------------------------------- |
| `i` | تطبیق بدون در نظر گرفتن حروف کوچک و بزرگ            |
| `m` | حالت چندخطی (تطبیق `^` و `$` با شروع و پایان هر خط) |
| `s` | تطبیق کاراکتر `.` با خطوط جدید (multi-line mode)    |
| `g` | تطبیق‌های چندگانه در طول کل رشته                    |

#### مثال:

```regex
/(?i)hello/i
```

این الگو بدون در نظر گرفتن کوچک یا بزرگ بودن حروف، کلمه `hello` را تطبیق می‌دهد.

## 6. ترفندهای پیشرفته و کاربردی

### 6.1. تطبیق کلمات تکراری

می‌توانید با استفاده از گروه‌های نام‌گذاری شده و بازخوانی، کلمات تکراری را پیدا کنید.

#### مثال:

```regex
\b(?<word>\w+)\b\s+\k<word>\b
```

این الگو کلمات تکراری مانند `hello hello` را پیدا می‌کند.

### 6.2. بررسی کلمات ترکیبی

با استفاده از شرط‌ها و گروه‌بندی‌های پیچیده، می‌توانید بررسی کنید که آیا یک رشته شامل چندین الگوی خاص است.

#### مثال:

```regex
(?=.*\bhello\b)(?=.*\bworld\b).*
```

این الگو بررسی می‌کند که آیا کلمات `hello` و `world` هر دو در رشته حضور دارند.

### 6.3. شناسایی رشته‌های خاص در قالب JSON یا XML

Regex برای پردازش داده‌های ساختاریافته مثل JSON و XML می‌تواند به شما کمک کند.

#### مثال:

```regex
<(\w+)>(.*?)</\1>
```

این الگو تگ‌های XML را با محتوای آن‌ها تطبیق می‌دهد و مطمئن می‌شود که تگ باز و بسته با هم مطابقت دارند.

## 7. استفاده از Regex در ابزارهای پیشرفته

### 7.1. استفاده از Regex در `sed`

ابزار `sed` برای ویرایش مستقیم فایل‌ها از Regex استفاده می‌کند.

#### مثال:

```bash
sed -E 's/([A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,})/EMAIL_REPLACED/g' file.txt
```

این دستور همه ایمیل‌ها را با `EMAIL_REPLACED` جایگزین می‌کند.

### 7.2. استفاده از Regex در `awk`

`awk` به شما امکان می‌دهد تا داده‌ها را پردازش و با Regex فیلتر کنید.

#### مثال:

```bash
awk '/^ERROR/' logfile.txt
```

این دستور همه خطوطی که با `ERROR` شروع می‌شوند را استخراج می‌کند.
