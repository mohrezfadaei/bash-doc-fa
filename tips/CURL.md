# **راهنمای دستور `curl`**

دستور `curl` یک ابزار قدرتمند برای انتقال داده به یا از سرور است که از پروتکل‌های پشتیبانی‌شده (مانند HTTP، HTTPS، FTP و غیره) استفاده می‌کند. این دستور معمولاً برای تست APIها، دانلود فایل‌ها و ارسال درخواست به سرویس‌های وب به کار می‌رود.

## فهرست مطالب

- [نحو پایه](#نحو-پایه)
- [مثال‌های کاربردی](#مثال‌های-کاربردی)
  - [1. درخواست GET](#1-درخواست-get)
  - [2. درخواست GET با پارامترهای کوئری](#2-درخواست-get-با-پارامترهای-کوئری)
  - [3. درخواست POST](#3-درخواست-post)
  - [4. ارسال JSON در یک درخواست POST](#4-ارسال-json-در-یک-درخواست-post)
  - [5. دانلود یک فایل](#5-دانلود-یک-فایل)
  - [6. ذخیره پاسخ در یک فایل](#6-ذخیره-پاسخ-در-یک-فایل)
  - [7. دنبال کردن ریدایرکت‌ها](#7-دنبال-کردن-ریدایرکت‌ها)
  - [8. ارسال هدرها](#8-ارسال-هدرها)
  - [9. احراز هویت ساده](#9-احراز-هویت-ساده)
  - [10. حالت توضیحی](#10-حالت-توضیحی)
  - [11. دریافت تنها هدرها](#11-دریافت-تنها-هدرها)
- [کاربرد پیشرفته](#کاربرد-پیشرفته)
  - [1. استفاده از پراکسی](#1-استفاده-از-پراکسی)
  - [2. دانلود چند فایل](#2-دانلود-چند-فایل)
  - [3. محدودیت سرعت](#3-محدودیت-سرعت)
  - [4. آپلود یک فایل](#4-آپلود-یک-فایل)
  - [5. ارسال چند هدر](#5-ارسال-چند-هدر)
- [نکات و ترفندها](#نکات-و-ترفندها)
  - [1. تست API با روش‌های مختلف](#1-تست-api-با-روش‌های-مختلف)
  - [2. بررسی اتصال به یک سرور](#2-بررسی-اتصال-به-یک-سرور)
  - [3. بررسی زمان پاسخگویی سرور](#3-بررسی-زمان-پاسخگویی-سرور)
  - [4. استفاده از کوکی‌ها](#4-استفاده-از-کوکی‌ها)
  - [5. تلاش مجدد برای درخواست‌های ناموفق](#5-تلاش-مجدد-برای-درخواست‌های-ناموفق)
  - [6. استفاده با HTTPS](#6-استفاده-با-https)
  - [7. دانلود به صورت موازی](#7-دانلود-به-صورت-موازی)
  - [8. مدیریت فایل‌های بزرگ](#8-مدیریت-فایل‌های-بزرگ)
- [متغیرهای محیطی](#متغیرهای-محیطی)
- [خطاهای متداول](#خطاهای-متداول)
- [استفاده از `curl` در اسکریپت‌های Bash](#استفاده-از-curl-در-اسکریپت‌های-bash)
- [نکات و ترفندهای جالب](#نکات-و-ترفندهای-جالب)

## **نحو پایه**

```bash
curl [گزینه‌ها] [URL]
```

### **گزینه‌های متداول**

- `-X [method]`: مشخص کردن متد درخواست (GET, POST, PUT, DELETE و ...)
- `-d [data]`: ارسال داده‌ها در یک درخواست POST.
- `-H [header]`: ارسال هدرها با درخواست.
- `-i`: شامل کردن هدرهای HTTP در خروجی.
- `-o [filename]`: ذخیره پاسخ در یک فایل.
- `-O`: ذخیره فایل با همان نام موجود در URL.
- `-L`: دنبال کردن ریدایرکت‌ها.
- `-I`: دریافت تنها هدرهای پاسخ.
- `-u [user:password]`: ارسال احراز هویت ساده HTTP.
- `-v`: فعال کردن خروجی توضیحی برای اشکال‌زدایی.

---

## **مثال‌های کاربردی**

### 1. **درخواست GET**

```bash
curl https://api.example.com/data
```

این دستور یک درخواست GET ساده به URL داده‌شده ارسال می‌کند.

### 2. **درخواست GET با پارامترهای کوئری**

```bash
curl "https://api.example.com/search?q=curl"
```

توجه داشته باشید که از علامت‌های نقل قول برای مدیریت پارامترهای کوئری با کاراکترهای خاص استفاده شده است.

### 3. **درخواست POST**

```bash
curl -X POST -d "name=John&age=30" https://api.example.com/submit
```

این دستور یک درخواست POST با داده‌های فرم ارسال می‌کند.

### 4. **ارسال JSON در یک درخواست POST**

```bash
curl -X POST -H "Content-Type: application/json" -d '{"name":"John", "age":30}' https://api.example.com/submit
```

این درخواست یک payload JSON را در بدنه ارسال می‌کند.

### 5. **دانلود یک فایل**

```bash
curl -O https://example.com/file.zip
```

این دستور فایل را دانلود کرده و در دایرکتوری فعلی ذخیره می‌کند.

### 6. **ذخیره پاسخ در یک فایل**

```bash
curl -o output.txt https://api.example.com/data
```

این پاسخ را در `output.txt` ذخیره می‌کند.

### 7. **دنبال کردن ریدایرکت‌ها**

```bash
curl -L https://short.url/abc
```

گزینه `-L` به `curl` می‌گوید که ریدایرکت‌ها را دنبال کند.

### 8. **ارسال هدرها**

```bash
curl -H "Authorization: Bearer token123" https://api.example.com/data
```

این دستور یک هدر سفارشی را با درخواست ارسال می‌کند.

### 9. **احراز هویت ساده**

```bash
curl -u user:password https://api.example.com/secure
```

این دستور احراز هویت ساده HTTP را با درخواست ارسال می‌کند.

### 10. **حالت توضیحی**

```bash
curl -v https://api.example.com
```

این گزینه اطلاعات دقیقی درباره درخواست و پاسخ فراهم می‌کند که برای اشکال‌زدایی مفید است.

### 11. **دریافت تنها هدرها**

```bash
curl -I https://example.com
```

این دستور تنها هدرهای سرور را دریافت می‌کند و نه بدنه پاسخ.

---

## **کاربرد پیشرفته**

### 1. **استفاده از پراکسی**

```bash
curl -x http://proxy.example.com:8080 https://api.example.com/data
```

این دستور درخواست را از طریق پراکسی مشخص‌شده ارسال می‌کند.

### 2. **دانلود چند فایل**

```bash
curl -O https://example.com/file1.zip -O https://example.com/file2.zip
```

می‌توانید از گزینه `-O` برای دانلود چندین فایل در یک دستور استفاده کنید.

### 3. **محدودیت سرعت**

```bash
curl --limit-rate 100k https://example.com/file.zip
```

سرعت دانلود را به 100 کیلوبایت بر ثانیه محدود می‌کند.

### 4. **آپلود یک فایل**

```bash
curl -T upload.txt https://example.com/upload
```

این دستور فایل `upload.txt` را به URL مشخص‌شده آپلود می‌کند.

### 5. **ارسال چند هدر**

```bash
curl -H "Authorization: Bearer token123" -H "User-Agent: MyApp" https://api.example.com/data
```

می‌توانید چندین هدر را با تکرار گزینه `-H` ارسال کنید.

## **نکات و ترفندها**

### 1. **تست یک API با روش‌های مختلف**

با مشخص کردن روش‌های مختلف می‌توانید به راحتی APIها را تست کنید:

```bash
curl -X PUT -d '{"key":"value"}' https://api.example.com/resource
curl -X DELETE https://api.example.com/resource/123
```

این کار به شما امکان می‌دهد تا متدهای HTTP مختلف مانند PUT، DELETE و PATCH را تست کنید.

### 2. **بررسی اتصال به یک سرور**

برای بررسی سریع دسترسی به یک سرور، می‌توانید از `curl` استفاده کنید:

```bash
curl -v https://example.com
```

خروجی توضیحی (Verbose) جزئیات مربوط به اتصال را به شما نشان می‌دهد.

### 3. **بررسی زمان پاسخگویی سرور**

می‌توانید زمان پاسخگویی سرور را اندازه‌گیری کنید:

```bash
curl -w "@curl-format.txt" -o /dev/null -s https://example.com
```

یک مثال از فایل `curl-format.txt`:

```
    time_namelookup:  %{time_namelookup}\n
    time_connect:  %{time_connect}\n
    time_starttransfer:  %{time_starttransfer}\n
    time_total:  %{time_total}\n
```

### 4. **استفاده از کوکی‌ها**

اگر نیاز به ارسال کوکی‌ها همراه با درخواست دارید:

```bash
curl -b "session=abcd1234" https://example.com/dashboard
```

همچنین می‌توانید کوکی‌ها را در یک فایل ذخیره کرده و بعدها ارسال کنید:

```bash
curl -c cookies.txt https://example.com
curl -b cookies.txt https://example.com/dashboard
```

### 5. **تلاش مجدد برای درخواست‌های ناموفق**

می‌توانید در صورت شکست درخواست، آن را چندین بار تکرار کنید:

```bash
curl --retry 5 https://example.com
```

### 6. **استفاده با HTTPS**

اگر به سروری با گواهی خود-امضایی (self-signed) متصل می‌شوید، می‌توانید از گزینه `-k` برای نادیده گرفتن اعتبار گواهی استفاده کنید:

```bash
curl -k https://self-signed.example.com
```

برای سیستم‌های تولیدی، همیشه اعتبار گواهی SSL را با دستور زیر بررسی کنید:

```bash
curl --cacert /path/to/cert.pem https://example.com
```

### 7. **دانلود به صورت موازی**

برای دانلودهای بزرگ، می‌توانید از چندین اتصال برای افزایش سرعت استفاده کنید:

```bash
curl -Z https://example.com/file1.zip https://example.com/file2.zip
```

این دستور فایل‌ها را به‌طور همزمان دانلود می‌کند.

### 8. **مدیریت فایل‌های بزرگ**

در زمان کار با فایل‌های بزرگ، می‌توانید دانلود را بعد از قطعی ادامه دهید:

```bash
curl -C - -O https://example.com/largefile.zip
```

گزینه `-C -` دانلود قبلی را ادامه می‌دهد.

---

## **متغیرهای محیطی**

می‌توانید از متغیرهای محیطی برای تنظیم رفتار `curl` استفاده کنید:

- `http_proxy` و `https_proxy`: تعریف پراکسی‌ها برای HTTP/HTTPS.
- `CURL_CA_BUNDLE`: استفاده از گواهی CA خاص.
- `CURL_HOME`: تنظیم دایرکتوری اصلی برای فایل‌های تنظیمات `curl`.

---

## **خطاهای متداول**

- **خطای گواهی SSL**: برای نادیده گرفتن گواهی‌های خود-امضایی از `-k` استفاده کنید (برای سیستم‌های تولیدی توصیه نمی‌شود).
- **تایم‌اوت**: از `--max-time` برای تنظیم حداکثر زمان اجرای دستور استفاده کنید:

  ```bash
  curl --max-time 10 https://example.com
  ```

- **اتصال رد شد**: URL و تنظیمات پراکسی را بررسی کنید، یا برای عیب‌یابی از `-v` برای خروجی توضیحی استفاده کنید.

---

## **استفاده از `curl` در اسکریپت‌های Bash**

`curl` به طور گسترده در اسکریپت‌های Bash برای خودکارسازی وظایف، مانند کار با APIها، دانلود فایل‌ها یا آپلود داده‌ها استفاده می‌شود. در زیر برخی از موارد کاربردی معمول آورده شده است.

### 1. **مثال پایه: دریافت داده**

```bash
#!/bin/bash

response=$(curl -s https://api.example.com/data)
echo "Response: $response"
```

این اسکریپت پاسخ درخواست GET را در یک متغیر ذخیره کرده و نمایش می‌دهد.

### 2. **بررسی کد وضعیت HTTP**

```bash
#!/bin/bash

url="https://api.example.com/data"
status_code=$(curl -o /dev/null -s -w "%{http_code}\n" "$url")

if [[ "$status_code" -eq 200 ]]; then
  echo "Request successful!"
else
  echo "Failed with status code: $status_code"
fi
```

این اسکریپت کد وضعیت درخواست را بررسی کرده و بر اساس آن عمل می‌کند.

### 3. **ارسال داده به API با روش POST**

```bash
#!/bin/bash

url="https://api.example.com/submit"
data='{"name":"John","age":30}'

response=$(curl -s -X POST -H "Content-Type: application/json" -d "$data" "$url")
echo "Server response: $response"
```

این اسکریپت داده‌های JSON را در یک درخواست POST ارسال کرده و پاسخ را مدیریت می‌کند.

### 4. **دانلود یک فایل**

```bash
#!/bin/bash

url="https://example.com/file.zip"
output="file.zip"

curl -o "$output" "$url"
echo "File downloaded to $output"
```

این اسکریپت یک فایل را دانلود کرده و آن را در مسیر مشخص‌شده ذخیره می‌کند.

### 5. **مدیریت احراز هویت در اسکریپت**

```bash
#!/bin/bash

username="your_username"
password="your_password"
url="https://api.example.com/secure"

response=$(curl -s -u "$username:$password" "$url")
echo "Authenticated response: $response"
```

این اسکریپت از احراز هویت ساده HTTP با `curl` استفاده می‌کند.

### 6. **منطق تلاش مجدد در Bash با `curl`**

```bash
#!/bin/bash

url="https://example.com/api"
max_retries=5
retry_delay=3
attempt=1

while [[ $attempt -le $max_retries ]]; do
  response=$(curl -s -o /dev/null -w "%{http_code}" "$url")

  if [[ $response -eq 200 ]]; then
    echo "Request successful on attempt $attempt"
    break
  else
    echo "Attempt $attempt failed. Retrying in $retry_delay seconds..."
    sleep $retry_delay
  fi

  ((attempt++))
done
```

این اسکریپت تا تعداد مشخصی تلاش می‌کند تا درخواست موفقیت‌آمیز باشد و بین هر تلاش تأخیری ایجاد می‌کند.

### 7. **ذخیره خروجی در فایل در اسکریپت**

```bash
#!/bin/bash

url="https://example.com/data"
output_file="output.txt"

curl -s "$url" -o "$output_file"

if [[ -f "$output_file" ]]; then
  echo "Output saved to $output_file"
else
  echo "Failed to save output"
fi
```

این اسکریپت داده‌ها را دریافت کرده و در یک فایل ذخیره می‌کند، همچنین بررسی می‌کند که فایل ایجاد شده باشد.

---

## **نکات و ترفندهای جالب**

`curl` دارای ترفندهای بسیاری است که می‌تواند برای بازیابی سریع داده‌ها مفید باشد. در زیر تعدادی از ترفندهای جالب آورده شده است:

### 1. **دریافت داده‌های آب و هوا**

```bash
curl wttr.in/tehran
```

این دستور آب و هوای فعلی تهران را دریافت می‌کند. می‌توانید نام شهر را به هر شهر دیگری تغییر دهید تا آب و هوای آن مکان را دریافت کنید.

برای داده‌های دقیق‌تر:

```bash
curl "wttr.in/tehran?format=%C+%t"
```

این دستور تنها شرایط فعلی آب و هوا و دما را نمایش می‌دهد.

### 2. **دریافت آدرس IP عمومی شما**

```bash
curl ifconfig.me
```

این دستور آدرس IP عمومی شما را برمی‌گرداند. یک سرویس مشابه دیگر:

```bash
curl ipinfo.io/ip
```

### 3. **دریافت آمار COVID-19**

می‌توانید آمار COVID-19 را با `curl` دریافت کنید:

```bash
curl https://corona-stats.online
```

این دستور آخرین آمار جهانی COVID-19 را نمایش می‌دهد. با افزودن `?source=2` نسخه دقیق‌تری را دریافت کنید.

### 4. **ترجمه متن با استفاده از API ترجمه گوگل**

```bash
curl "https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=es&dt=t&q=Hello%20world"
```

این دستور عبارت "Hello world" را به اسپ

انیایی (`tl=es`) ترجمه می‌کند. می‌توانید `tl` را تغییر دهید تا به زبان‌های مختلف مانند `fr` برای فرانسوی یا `de` برای آلمانی ترجمه شود.

### 5. **بررسی وضعیت یک وب‌سایت**

```bash
curl -Is https://example.com | head -n 1
```

این دستور وضعیت HTTP یک وب‌سایت را بررسی می‌کند. اگر وب‌سایت فعال باشد، چیزی مانند `HTTP/1.1 200 OK` برمی‌گرداند.

### 6. **دریافت تصویر نجومی روز (APOD) از NASA**

```bash
curl https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY
```

این دستور تصویر نجومی روز را از API ناسا دریافت می‌کند. `DEMO_KEY` را با کلید API خود جایگزین کنید.

### 7. **دانلود تصاویر از یک وب‌سایت**

```bash
curl -O https://example.com/image.jpg
```

این دستور یک تصویر را از URL مشخص‌شده مستقیماً در دایرکتوری فعلی دانلود می‌کند.

### 8. **بررسی ریدایرکت‌های یک وب‌سایت**

```bash
curl -I -L https://example.com
```

این دستور هدرهای HTTP را نمایش می‌دهد و ریدایرکت‌ها را پیگیری می‌کند.

### 9. **دریافت قیمت بیت‌کوین**

```bash
curl https://api.coindesk.com/v1/bpi/currentprice/BTC.json
```

این دستور قیمت فعلی بیت‌کوین را در ارزهای مختلف دریافت می‌کند.

### 10. **تبدیل ارز**

می‌توانید از `curl` برای تبدیل ارزها با استفاده از API نرخ ارز استفاده کنید:

```bash
curl "https://api.exchangerate-api.com/v4/latest/USD"
```

این دستور نرخ‌های فعلی ارز برای USD را دریافت می‌کند. کد `USD` را با ارز دیگری جایگزین کنید تا نرخ‌های مربوط به آن را دریافت کنید.
